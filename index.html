<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Минималистичная игра</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: Arial, sans-serif;
        background: #000;
        color: #fff;
        overflow: hidden;
    }
    #background-canvas {
        position: fixed;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
    }
    .center-container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100%;
    }
    .menu, .form-container {
        background: rgba(0, 0, 0, 0.7);
        padding: 20px 30px;
        border: 1px solid #fff;
        border-radius: 8px;
        text-align: center;
        width: 300px;
    }
    h1 {
        margin-bottom: 20px;
    }
    input {
        width: 100%;
        padding: 10px;
        margin: 8px 0;
        border: 1px solid #fff;
        border-radius: 4px;
        background: #000;
        color: #fff;
    }
    button {
        width: 100%;
        padding: 10px;
        background: #fff;
        color: #000;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        margin-top: 10px;
    }
    button:hover {
        background: #ccc;
    }
    .hidden {
        display: none;
    }
</style>
</head>
<body>

<canvas id="background-canvas"></canvas>

<div class="center-container">
    <div class="menu" id="menu">
        <h1>Меню</h1>
        <button onclick="showLogin()">Вход</button>
        <button onclick="showRegister()">Регистрация</button>
    </div>

    <div class="form-container hidden" id="loginForm">
        <h1>Вход</h1>
        <input type="text" id="loginNickname" placeholder="Никнейм">
        <input type="password" id="loginPassword" placeholder="Пароль">
        <button onclick="login()">Войти</button>
        <button onclick="showMenu()">Назад</button>
    </div>

    <div class="form-container hidden" id="registerForm">
        <h1>Регистрация</h1>
        <input type="text" id="registerNickname" placeholder="Никнейм">
        <input type="password" id="registerPassword" placeholder="Пароль">
        <button onclick="register()">Зарегистрироваться</button>
        <button onclick="showMenu()">Назад</button>
    </div>
</div>

<!-- Подключение Supabase -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<!-- Подключение bcryptjs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcrypt.min.js"></script>

<script>
    const { createClient } = supabase;
    const supabaseUrl = "https://nkhshvlixjqbeyouapnd.supabase.co";
    const supabaseKey = "sb_publishable_H9wczHVQq_YvP4v6xtAT_w_0-XDNwha";
    const db = createClient(supabaseUrl, supabaseKey);

    function showMenu() {
        document.getElementById('menu').classList.remove('hidden');
        document.getElementById('loginForm').classList.add('hidden');
        document.getElementById('registerForm').classList.add('hidden');
    }
    function showLogin() {
        document.getElementById('menu').classList.add('hidden');
        document.getElementById('loginForm').classList.remove('hidden');
        document.getElementById('registerForm').classList.add('hidden');
    }
    function showRegister() {
        document.getElementById('menu').classList.add('hidden');
        document.getElementById('registerForm').classList.remove('hidden');
        document.getElementById('loginForm').classList.add('hidden');
    }

    async function register() {
        const nickname = document.getElementById('registerNickname').value.trim();
        const password = document.getElementById('registerPassword').value;

        if (!nickname || !password) {
            alert("Введите ник и пароль");
            return;
        }

        const hashedPassword = bcrypt.hashSync(password, 10);

        const { error } = await db.from("users").insert({
            nickname: nickname,
            password_hash: hashedPassword,
            crystals: 0
        });

        if (error) {
            alert("Ошибка: " + error.message);
        } else {
            alert("Регистрация успешна!");
            showMenu();
        }
    }

    async function login() {
        const nickname = document.getElementById('loginNickname').value.trim();
        const password = document.getElementById('loginPassword').value;

        const { data, error } = await db.from("users").select("*").eq("nickname", nickname).single();

        if (error || !data) {
            alert("Неверный ник или пароль");
            return;
        }

        if (!bcrypt.compareSync(password, data.password_hash)) {
            alert("Неверный пароль");
            return;
        }

        alert("Вход выполнен! Кристаллы: " + data.crystals);
        // Здесь можно запустить игру
    }

    // Анимация шариков
    const canvas = document.getElementById("background-canvas");
    const ctx = canvas.getContext("2d");
    let balls = [];

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }

    function createBalls() {
        balls = [];
        for (let i = 0; i < 30; i++) {
            balls.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                r: Math.random() * 5 + 2,
                dx: (Math.random() - 0.5) * 1.5,
                dy: (Math.random() - 0.5) * 1.5
            });
        }
    }

    function drawBalls() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#fff";
        balls.forEach(b => {
            ctx.beginPath();
            ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
            ctx.fill();
            b.x += b.dx;
            b.y += b.dy;
            if (b.x < 0 || b.x > canvas.width) b.dx *= -1;
            if (b.y < 0 || b.y > canvas.height) b.dy *= -1;
        });
        requestAnimationFrame(drawBalls);
    }

    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();
    createBalls();
    drawBalls();
</script>
</body>
</html>
